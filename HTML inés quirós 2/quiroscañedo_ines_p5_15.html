<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>T15-Disparo simple con objetivo y contador</title>
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
    </head>
    <body>
        <script>

      
        let xS, yS, dS, rS, vS;//sol
		let xL, yL, dL, rL, vL;//luna
		let dia, mes, anio;//calendario
 
        let xP, yP;        // posici칩n del personaje
        let S;             // tama침o stickman
        let vP;            // velocidad 
        let groundY;       // altura del suelo         
         let vY;            // velocidad salto
        let jumpV;         // impulso del salto 
        let g;             // gravedad 
        
        let rHead //cabeza
        let bodyL //cuerpo
        let armL  //brazo
        let legL  //pierna
        
        let hipY // cadera por encima de los pies
        let shoulderY  // hombros por encima de la cadera
        let headY // centro de la cabeza
// Disparo
let xD, yD, tD, vD, disparoActivo = false;

// Objetivo
let xO, yO, wO, hO, vO;
   let puntos = 0; // contador de puntos
        function setup() {
            createCanvas(900, 500);
			// Inicializaci칩n del disparo
    tD = 0.05 * width;  // Tama침o del disparo
    vD = height / 60;   // Velocidad del disparo
    disparoActivo = false;

    // Inicializaci칩n del objetivo
    wO = 0.15 * width;  // Ancho del objetivo
    hO = 0.05 * height; // Alto del objetivo
    xO = random(width); // Posici칩n inicial del objetivo
    yO = 0.60 * height; // Posici칩n vertical del objetivo
    vO = random(1, 3) * (random(1) > 0.5 ? 1 : -1); // Velocidad aleatoria de movimiento horizontal

  

			//sol
            dS = 0.1 * width;    
            rS = dS / 2;
            yS = 0.2 * height;  
            xS = -rS;            // por la izquierda
            vS = width / 400;  
//luna
dL = dS * 0.5; 
rL = dL / 2; 
xL = -width - rL; // fuera a la izquierda 
yL = height / 3; 
vL = vS; 		
//calendario
dia = 1;
mes = 1;
anio = 2025;
// Suelo 
groundY = 0.80 * height;

// Stickman: tama침o y posici칩n inicial
S  = 0.12 * min(width, height);
xP = 0.25 * width;
yP = groundY;                 //  posici칩n de los pies

// Movimiento horizontal
vP = width / 150;

// Salto (valores sencillos)
vY = 0;
jumpV = -0.030 * height;      // impulso hacia arriba
g = 0.0016 * height;          // aceleraci칩n hacia abajo (peque침a)
 //Stickman
            rHead = 0.20 * S;
            bodyL = 0.60 * S;
            armL  = 0.45 * S;
            legL  = 0.55 * S;
            hipY = yP - legL;          
            shoulderY = hipY - bodyL;  
            headY = shoulderY - rHead; 
        }

       function draw() {

    // D칤a / noche
    if (xS <= width + rS) {
        background(130, 206, 230); // d칤a
    } else {
        background(10); // noche
    }

    // Prado
    noStroke();
    fill(20, 120, 40);
    rect(0, 0.8 * height, width, 0.2 * height);

    // Sol
    fill(255, 210, 0);
    circle(xS, yS, dS);

    // Luna
    fill(200);
    circle(xL, yL, dL);

    // Movimiento
    xS += vS;
    xL += vL;

    // Reinicio + calendario
  if (xS >= 2 * width - rS) {
    xS = -rS;
    xL = -width - rL;

    actualizarCalendario();
}


    // Mostrar fecha
    textSize(20);
    fill(100);
    text("Fecha: (" + dia + ") (" + mes + ") (" + anio + ")", 10, 20);
 
     dibujarStickman();
	 
    // Movimiento del objetivo
    xO += vO;
    if (xO > width || xO < 0) {
        // Cuando el objetivo sale de los bordes, lo recolocamos con nueva velocidad
        xO = (xO > width) ? 0 : width;
        vO = random(1, 3) * (random(1) > 0.5 ? 1 : -1);
    }

    // Dibujar objetivo
    dibujarObjetivo();

    // Movimiento del disparo
 if (disparoActivo) {

    // 游댮 COMPROBAR IMPACTO PRIMERO
    if (
        xD + tD > xO &&
        xD < xO + wO &&
        yD + tD > yO &&
        yD < yO + hO
    ) {
        puntos++;
        disparoActivo = false;

        xO = random(width);
        yO = 0.60 * height;
        vO = random(1, 3) * (random(1) > 0.5 ? 1 : -1);
    }

    // 游댯 LUEGO mover
    yD -= vD;

    if (yD < 0) disparoActivo = false;

    dibujarDisparo();
}
    // Comprobaci칩n de impacto
 if (
    disparoActivo &&
    xD + tD > xO &&
    xD < xO + wO &&
    yD + tD > yO &&
    yD < yO + hO
) {
    puntos++;
    disparoActivo = false;

    // Reaparece el objetivo
    xO = random(width);
    yO = 0.60 * height;
    vO = random(1, 3) * (random(1) > 0.5 ? 1 : -1);
}


    // Mostrar puntos
    dibujarPuntos();
}
	 
function dibujarStickman() { //Stickman
            stroke(255, 43, 0);
            strokeWeight(0.06 * S);
            noFill(0);
// Cabeza
            circle(xP, headY, 2 * rHead);

            // Tronco
            line(xP, shoulderY, xP, hipY);

            // Brazos (una l칤nea horizontal + dos l칤neas hacia abajo)
            line(xP - 0.25*S, shoulderY, xP + 0.25*S, shoulderY);
            line(xP - 0.25*S, shoulderY, xP - 0.25*S, shoulderY + armL);
            line(xP + 0.25*S, shoulderY, xP + 0.25*S, shoulderY + armL);

            // Piernas
            line(xP, hipY, xP - 0.18*S, yP);
            line(xP, hipY, xP + 0.18*S, yP);
            
            if (keyIsDown(LEFT_ARROW)) {
                xP = xP - vP;} 
            else if (keyIsDown(RIGHT_ARROW)) {
                xP = xP + vP;}
            
            if (xP < 0) {
            xP = 0;}
            if (xP > width) {
            xP = width;}    
            
            // F칤sica m칤nima del salto (se ejecuta siempre) 
            vY = vY + g; // gravedad 
            yP = yP + vY; // actualiza pies
            // Si toca el suelo, corregimos 
            if (yP > groundY) 
            { yP = groundY; vY = 0; }
            
            //Recalcular cuerpo seg칰n yP
            hipY = yP - legL;          
            shoulderY = hipY - bodyL;  
            headY = shoulderY - rHead;
}
function actualizarCalendario() {
    dia++;

    if (dia > 30) {
        dia = 1;
        mes = mes + 1;
    }

    if (mes > 12) {
        mes = 1;
        anio = anio + 1;
    }}
	
	function dibujarDisparo() {
    fill(255, 0, 0); // Color rojo
    noStroke();
    // Dibujo del disparo (puedes usar lo que prefieras, aqu칤 un rect치ngulo)
    rect(xD, yD, tD, tD);
}

function dibujarObjetivo() {
    fill(0, 255, 0); // Color verde
    noStroke();
    rect(xO, yO, wO, hO);
}

function dibujarPuntos() {
    fill(255, 0, 0);   // color visible
    noStroke();
    textSize(22);
    text("Puntos: " + puntos, width - 150, 30);
}
function keyPressed() {

    // Disparo
    if (keyCode === 32 && !disparoActivo) {
        disparoActivo = true;
        xD = xP;
        yD = yP - rHead;
    }

    // Salto
    if (keyCode === UP_ARROW && yP === groundY) {
        vY = jumpV;
    }
}



        </script>
    </body>
</html>
