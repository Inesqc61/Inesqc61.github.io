<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>T16 — Impacto y contador de puntos</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
</head>

<body>
<script>
// Sol y luna
let xS, yS, dS, rS, vS;
let xL, yL, dL, rL, vL;

// Calendario
let dia, mes, anio;

// Stickman
let xP, yP;
let S;
let vP;
let groundY;
let vY, jumpV, g;

let rHead, bodyL, armL, legL;
let hipY, shoulderY, headY;

// Disparo
let xD, yD, tD, vD;
let disparoActivo;

// Objetivo
let xO, yO, wO, hO, vO;

// Puntos
let puntos;

function setup() {
    createCanvas(900, 500);

    // Disparo
    tD = 0.05 * width;
    vD = height / 60;
    disparoActivo = false;

    // Objetivo
    wO = 0.15 * width;
    hO = 0.05 * height;
    xO = -wO;
    yO = random(0.2 * height, 0.35 * height);
    vO = random(1, 3);

    // Sol
    dS = 0.1 * width;
    rS = dS / 2;
    xS = -rS;
    yS = 0.2 * height;
    vS = width / 400;

    // Luna
    dL = dS * 0.5;
    rL = dL / 2;
    xL = -width - rL;
    yL = height / 3;
    vL = vS;

    // Calendario
    dia = 1;
    mes = 1;
    anio = 2025;

    // Suelo
    groundY = 0.8 * height;

    // Stickman
    S = 0.12 * min(width, height);
    xP = 0.25 * width;
    yP = groundY;
    vP = width / 150;

    vY = 0;
    jumpV = -0.03 * height;
    g = 0.0016 * height;

    rHead = 0.2 * S;
    bodyL = 0.6 * S;
    armL = 0.45 * S;
    legL = 0.55 * S;

    hipY = yP - legL;
    shoulderY = hipY - bodyL;
    headY = shoulderY - rHead;

    // Puntos
    puntos = 0;
}

function draw() {

    // Día / noche
    if (xS <= width + rS) {
        background(130, 206, 230);
    } else {
        background(10);
    }

    // Suelo
    noStroke();
    fill(20, 120, 40);
    rect(0, groundY, width, height - groundY);

    // Sol y luna
    dibujarSol();
    dibujarLuna();

    // Movimiento sol y luna + calendario
    xS += vS;
    xL += vL;

    if (xS >= 2 * width - rS) {
        xS = -rS;
        xL = -width - rL;
        actualizarCalendario();
    }

    // Movimiento del objetivo
    xO += vO;

    if (xO > width + wO) {
        xO = -wO;
        yO = random(0.2 * height, 0.35 * height);
        vO = random(1, 3);
    }

    if (xO < -wO) {
        xO = width + wO;
        yO = random(0.2 * height, 0.35 * height);
        vO = -random(1, 3);
    }

    // Movimiento del disparo
    if (disparoActivo) {
        yD -= vD;

        // Impacto
        if (
            xD > xO &&
            xD < xO + wO &&
            yD > yO &&
            yD < yO + hO
        ) {
            puntos = puntos + 1;
            disparoActivo = false;

            if (vO > 0) {
                xO = width + wO;
                vO = -random(1, 3);
            } else {
                xO = -wO;
                vO = random(1, 3);
            }

            yO = random(0.2 * height, 0.35 * height);
        }

        if (yD < 0) {
            disparoActivo = false;
        }
    }

    // Dibujo del objetivo
    dibujarObjetivo();

    // Dibujo del disparo
    if (disparoActivo) {
        dibujarDisparo();
    }

    // Stickman
    dibujarStickman();


    dibujarCalendario();
    dibujarPuntos();
}

function dibujarSol() {
    fill(255, 210, 0);
    noStroke();
    circle(xS, yS, dS);
}

function dibujarLuna() {
    fill(200);
    noStroke();
    circle(xL, yL, dL);
}

function dibujarObjetivo() {
    fill(0, 255, 0);
    noStroke();
    rect(xO, yO, wO, hO);
}

function dibujarDisparo() {
    fill(255, 0, 0);
    noStroke();
    rect(xD, yD, tD, tD);
}

function dibujarStickman() {
    stroke(255, 43, 0);
    strokeWeight(0.06 * S);
    noFill();

    circle(xP, headY, 2 * rHead);
    line(xP, shoulderY, xP, hipY);

    line(xP - 0.25*S, shoulderY, xP + 0.25*S, shoulderY);
    line(xP - 0.25*S, shoulderY, xP - 0.25*S, shoulderY + armL);
    line(xP + 0.25*S, shoulderY, xP + 0.25*S, shoulderY + armL);

    line(xP, hipY, xP - 0.18*S, yP);
    line(xP, hipY, xP + 0.18*S, yP);

    if (keyIsDown(LEFT_ARROW)) xP -= vP;
    if (keyIsDown(RIGHT_ARROW)) xP += vP;

    vY += g;
    yP += vY;

    if (yP > groundY) {
        yP = groundY;
        vY = 0;
    }

    hipY = yP - legL;
    shoulderY = hipY - bodyL;
    headY = shoulderY - rHead;
}

function dibujarCalendario() {
    fill(255);
    noStroke();
    textSize(20);
    text("Fecha: " + dia + " / " + mes + " / " + anio, 10, 25);
}

function dibujarPuntos() {
    fill(255);
    noStroke();
    textSize(20);
    text("Puntos: " + puntos, 10, 50);
}

function actualizarCalendario() {
    dia++;
    if (dia > 30) {
        dia = 1;
        mes++;
    }
    if (mes > 12) {
        mes = 1;
        anio++;
    }
}

function keyPressed() {
    // Disparo
    if (keyCode === 32 && !disparoActivo) {
        disparoActivo = true;
        xD = xP;
        yD = yP - rHead;
    }

    // Salto
    if (keyCode === UP_ARROW && yP === groundY) {
        vY = jumpV;
    }
}
</script>
</body>
</html>

